dependencies:
  override:
    - npm install
    - bundle install

    - pip install setuptools==0.6c11
    - pip install distribute==0.6.49
    - pip install -r requirements/edx/paver.txt

    # Mirror what paver install_prereqs does.
    # After a successful build, CircleCI will
    # cache the virtualenv at that state, so that
    # the next build will not need to install them
    # from scratch again.
    - pip install -r requirements/edx/pre.txt
    - pip install -r requirements/edx/github.txt
    - pip install -r requirements/edx/local.txt

    # HACK: within base.txt stevedore had a
    # dependency on a version range of pbr.
    # Install a version which falls within that range.
    - pip install pbr==0.9.0
    - pip install -r requirements/edx/base.txt
    - pip install -r requirements/edx/post.txt

machine:
  python:
    version: 2.7.3

general:
  artifacts:
    - "reports"
    - "test_root/log"

test:
  override:
    - case $CIRCLE_NODE_INDEX in 0) paver test_lib -l common/lib/calc ;; 1) paver test_system -t lms/djangoapps/courseware/tests/tests.py:ActivateLoginTest ;; 2) paver test_system -t cms/djangoapps/contentstore/tests/tests.py:AuthTestCase  ;; esac:
        parallel: true
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    # - find . -type f -regex ".*/reports/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;
    - cp -r reports/. $CIRCLE_TEST_REPORTS/junit
